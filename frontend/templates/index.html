{% extends "base.html" %}

{% block content %}
<div class="dashboard-layout">
    <!-- Left Sidebar -->
    <aside class="left-sidebar">
        <div class="sidebar-header">
            <h3>ğŸ“Š TablesAlive</h3>
        </div>

        <!-- Data Source Section -->
        <div class="sidebar-section">
            <h4>Data Source</h4>
            <!-- Datasource Selector Dropdown (shown when logged in with saved datasources) -->
            <div id="datasource-selector-container" style="display: none; margin-bottom: 15px;">
                <label for="datasource-selector">Select Data Source:</label>
                <select id="datasource-selector" class="input-select" style="width: 100%;">
                    <option value="">+ New Data Source</option>
                    <!-- Saved datasources will be populated here -->
                </select>
            </div>
            <div class="data-source-form">
                <label for="sheet_url">Google Sheet URL</label>
                <input type="text" id="sheet_url" placeholder="https://docs.google.com/..." class="input-text">
                <label for="gid_input">Sheet GID (Optional)</label>
                <input type="text" id="gid_input" placeholder="0" class="input-text">
                <label class="checkbox-container">
                    <input type="checkbox" id="has_headers" checked>
                    <span class="checkbox-label">1st row is headers</span>
                </label>
                <div class="data-source-actions">
                    <button id="load-data-btn" class="btn-primary btn-action-primary">
                        <span class="btn-icon-emoji">ğŸš€</span>
                        <span class="btn-text">Load Data</span>
                    </button>
                    <button id="reload-data-btn" class="btn-secondary btn-action-secondary" title="Reload Data">
                        <span class="btn-icon-emoji">ğŸ”„</span>
                        <span class="btn-text">Reload</span>
                    </button>
                    <button id="save-datasource-btn" class="btn-secondary btn-action-secondary" title="Save Data Source" style="display: none;">
                        <span class="btn-icon-emoji">ğŸ’¾</span>
                        <span class="btn-text">Save</span>
                    </button>
                    <button id="disconnect-data-btn" class="btn-danger btn-action-danger" title="Disconnect Data Source" style="display: none;">
                        <span class="btn-icon-emoji">ğŸ”Œ</span>
                        <span class="btn-text">Disconnect</span>
                    </button>
                </div>
            </div>
            <div class="connection-status" id="connection-status">
                <span class="status-indicator disconnected"></span>
                <span class="status-text">Not Connected</span>
            </div>
        </div>

        <!-- Column Renaming Section -->
        <details class="sidebar-section" id="column-rename-details" style="display: none;">
            <summary>Rename Columns</summary>
            <div id="rename-inputs-list" class="rename-inputs-list">
                <!-- Populated dynamically -->
            </div>
        </details>

        <!-- Filters Section -->
        <details class="sidebar-section" id="filters-details">
            <summary>Filters</summary>
            <div class="filter-builder">
                <button id="add-filter-btn" class="btn-secondary">+ Add Filter</button>
                <div id="active-filters" class="active-filters-list">
                    <!-- Dynamic filters will be added here -->
                </div>
            </div>
        </details>

        <!-- Add Widget Section -->
        <div class="sidebar-section">
            <h4>Add Widget</h4>
            <div class="widget-buttons">
                <button id="add-chart-btn" class="btn-primary">ğŸ“ˆ Add Chart</button>
                <button id="add-table-btn" class="btn-primary">ğŸ“‹ Add Table</button>
                <button id="add-report-btn" class="btn-secondary" style="display: none;">ğŸ“„ Add Report</button>
            </div>
        </div>
    </aside>

    <!-- Central Workspace -->
    <main class="central-workspace">
        <div class="workspace-header">
            <h2 id="dashboard-title">My Dashboard</h2>
            <div class="workspace-header-controls" style="display: flex; align-items: center; gap: 1rem;">
                <div class="grid-config" style="display: none;">
                    <label style="font-size: 0.9rem; color: var(--text-secondary, #666);">Grid:</label>
                    <input type="number" id="grid-cols-input" min="1" max="24" value="12" style="width: 60px; padding: 0.25rem 0.5rem; border: 1px solid var(--border-color, #e0e0e0); border-radius: 4px;">
                    <span style="color: var(--text-secondary, #666);">Ã—</span>
                    <input type="number" id="grid-rows-input" min="1" max="50" value="10" style="width: 60px; padding: 0.25rem 0.5rem; border: 1px solid var(--border-color, #e0e0e0); border-radius: 4px;">
                    <button id="apply-grid-btn" class="btn-secondary" style="padding: 0.25rem 0.75rem; font-size: 0.85rem;">Apply</button>
                </div>
                <button id="save-dashboard-btn" class="btn-primary" style="display: none;">ğŸ’¾ Save Dashboard</button>
            </div>
        </div>
        <div class="workspace-canvas" id="workspace-canvas">
            <!-- Widgets will be dynamically added here -->
            <div class="empty-canvas-message">
                <div class="empty-message">
                    <h3><span class="welcome-icon">ğŸ¯</span> <span class="welcome-text">Welcome to TablesAlive</span></h3>
                    <p>Connect a data source and start adding charts and tables to build your dashboard!</p>
                </div>
            </div>
        </div>
    </main>

    <!-- Right Context Panel -->
    <aside class="right-panel">
        <div class="panel-header">
            <h4>Widget Settings</h4>
        </div>
        <div id="sidebar-settings-content" class="sidebar-settings-content">
            <div class="settings-empty-msg">
                <p>Select a widget to configure its settings</p>
            </div>
        </div>
    </aside>
</div>

<!-- Active Filters Footer -->
<footer class="filters-footer" id="filters-footer" style="display: none;">
    <div class="footer-content">
        <span class="filters-label">Active Filters:</span>
        <div id="active-filters-display" class="active-filters-display">
            <!-- Active filter tags will be shown here -->
        </div>
        <button id="clear-all-filters-btn" class="btn-secondary">Clear All</button>
    </div>
</footer>

<!-- Widget Templates (hidden) -->
<div id="widget-templates" style="display: none;">
    <!-- Chart Widget Template -->
    <div class="widget chart-widget" data-type="chart">
        <!-- Resize Handles -->
        <div class="resize-handle corner top-left"></div>
        <div class="resize-handle corner top-right"></div>
        <div class="resize-handle corner bottom-left"></div>
        <div class="resize-handle corner bottom-right"></div>
        <div class="resize-handle edge top"></div>
        <div class="resize-handle edge bottom"></div>
        <div class="resize-handle edge left"></div>
        <div class="resize-handle edge right"></div>
        <div class="widget-header">
            <h4 class="widget-title" id="chart-widget-title">Chart Widget</h4>
            <div class="widget-actions">
                <button class="widget-config-btn" title="Widget Settings">âš™ï¸</button>
                <button class="widget-close-btn" title="Remove Widget">âœ•</button>
            </div>
        </div>
        <div class="widget-content">
            <div class="chart-container">
                <div class="chart-placeholder">
                    <!-- Chart rendered here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Table Widget Template -->
    <div class="widget table-widget" data-type="table">
        <!-- Resize Handles -->
        <div class="resize-handle corner top-left"></div>
        <div class="resize-handle corner top-right"></div>
        <div class="resize-handle corner bottom-left"></div>
        <div class="resize-handle corner bottom-right"></div>
        <div class="resize-handle edge top"></div>
        <div class="resize-handle edge bottom"></div>
        <div class="resize-handle edge left"></div>
        <div class="resize-handle edge right"></div>
        <div class="widget-header">
            <h4 class="widget-title" id="table-widget-title">Table Widget</h4>
            <div class="widget-actions">
                <button class="widget-config-btn" title="Widget Settings">âš™ï¸</button>
                <button class="widget-close-btn" title="Remove Widget">âœ•</button>
            </div>
        </div>
        <div class="widget-content">
            <div class="table-container">
                <!-- Table rendered here -->
            </div>
        </div>
    </div>
</div>

<!-- Report Selection Modal -->
<div class="modal-overlay" id="report-selection-modal" style="display: none;">
    <div class="auth-modal" style="max-width: 600px; max-height: 80vh; overflow-y: auto;">
        <button class="close-modal-btn" id="close-report-modal">âœ•</button>
        <h2>Select a Report to Add</h2>
        <div id="reports-selection-list" style="margin-top: 20px;">
            <div class="loading-message">Loading reports...</div>
        </div>
    </div>
</div>
{% endblock %}